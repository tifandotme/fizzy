name: Sync Fork

on:
  schedule:
    - cron: "0 20 * * *" # Daily at 3AM Jakarta (19:00 UTC)
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-slim

    steps:
      - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - run: git remote add upstream https://github.com/basecamp/fizzy || true

      - run: git fetch upstream --tags

      - id: get_tag
        run: echo "tag=$(git describe --tags --abbrev=0 upstream/HEAD)" >> $GITHUB_OUTPUT

      - name: Check tag
        run: |
          if [ -z "${{ steps.get_tag.outputs.tag }}" ]; then
            echo "No tags found on upstream."
            exit 1
          fi
          echo "Latest tag: ${{ steps.get_tag.outputs.tag }}"

      - run: git rebase ${{ steps.get_tag.outputs.tag }}

      - run: git push origin HEAD
